# Мониторинг пайплайнов и авторемонт

Pipeline Watcher обнаруживает сбои CI/CD-пайплайнов и автоматически генерирует и отправляет исправления с помощью ИИ.

## Обзор

```
┌──────────────┐     ┌───────────────┐     ┌──────────────┐     ┌──────────────┐
│  CI/CD        │ ──▶ │  Анализ       │ ──▶ │  Генерация    │ ──▶ │  Push        │
│  Сбой         │     │  причины      │     │  исправления  │     │  (авто)      │
│  (обнаружен)  │     │  (ИИ)         │     │  (ИИ)         │     │              │
└──────────────┘     └───────────────┘     └──────────────┘     └──────────────┘
```

## Включение

```yaml
repos:
  - name: my-repo
    workers:
      pipeline_watcher:
        enabled: true
```

## Поддерживаемые CI/CD платформы

| Платформа | Метод обнаружения |
|-----------|------------------|
| **GitHub Actions** | Webhook / API-опрос |
| **GitLab CI** | Webhook / API-опрос |
| **CircleCI** | API-опрос |
| **Jenkins** | Webhook |

## Типы обнаруживаемых ошибок

Pipeline Watcher автоматически классифицирует и обрабатывает следующие ошибки:

### Сбои тестов
- Ошибки модульных тестов
- Тайм-ауты интеграционных тестов
- Ошибки проверок E2E-тестов

### Ошибки сборки
- Ошибки компиляции
- Ошибки типов (TypeScript и др.)
- Ошибки разрешения зависимостей

### Линтинг / Форматирование
- Ошибки ESLint / Prettier
- Go lint, Clippy (Rust) и др.

### Сканирование безопасности
- Уязвимые зависимости
- Нарушения правил безопасности

## Процесс авторемонта

### 1. Обнаружение сбоя
Pipeline Watcher обнаруживает сбои CI/CD через webhook'и или опрос

### 2. Получение логов
Автоматически получает логи отказавшего задания и извлекает сообщения об ошибках

### 3. Анализ ИИ
Передаёт сообщения об ошибках и исходный код ИИ для определения причины

### 4. Генерация исправления
ИИ создаёт патч и отправляет дополнительный коммит в существующий PR

### 5. Проверка результата
Отслеживает результаты CI после исправления. При успехе — закрывает, при неудаче — повторяет

## Лимиты повторов

Для предотвращения бесконечных циклов авторемонта количество повторов ограничено:

| Параметр | По умолчанию | Описание |
|----------|-------------|----------|
| Макс. повторов | 3 | Попытки исправления на PR |
| Задержка | 5 мин | Время ожидания между повторами |

## Примеры использования

### Авторемонт сбоев тестов

```
1. PR создан
2. GitHub Actions запускает тесты
3. 2 теста не прошли
4. Pipeline Watcher обнаруживает сбой
5. ИИ анализирует логи тестов
6. Коммит с исправлением автоматически отправлен
7. Тесты перезапускаются → успех ✅
```

### Исправление ошибок зависимостей

```
1. Dependabot обновляет зависимость
2. Сборка ломается
3. Pipeline Watcher обнаруживает сбой
4. ИИ проверяет совместимость
5. Код обновлён для совместимости
6. Сборка успешна ✅
```

> [!TIP]
> Pipeline Watcher отслеживает сбои CI не только в PR, созданных [автоматизацией задач](ru/guides/issue-automation.md), но и в PR, созданных людьми.
