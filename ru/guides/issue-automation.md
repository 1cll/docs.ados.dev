# Автоматизация задач

Основная функция ADOS. ИИ автоматически решает задачи GitHub / GitLab / Bitbucket и создаёт Pull Request'ы.

## Принцип работы

```
┌──────────────┐     ┌─────────────┐     ┌──────────────┐     ┌──────────────┐
│  Задача       │ ──▶ │  ADOS        │ ──▶ │  ИИ           │ ──▶ │  PR создан   │
│  создана      │     │  Обнаружение │     │  Реализация   │     │  (авто)      │
│  (с меткой)   │     │              │     │               │     │              │
└──────────────┘     └─────────────┘     └──────────────┘     └──────────────┘
```

## Issue Watcher

Issue Watcher автоматически обнаруживает задачи с указанными метками.

### Настройка метки

```yaml
repos:
  - name: my-repo
    owner: my-org
    repo: my-repo
    label: ados          # Обрабатывать задачи с этой меткой
    target_branch: main  # Базовая ветка для PR
```

> [!TIP]
> Метка может быть любой строкой. По умолчанию — `ados`.

### Интервал опроса

```yaml
repos:
  - name: my-repo
    poll_interval: 30s   # Проверять задачи каждые 30 секунд
    workers:
      issue_watcher:
        enabled: true
```

## Написание хороших задач

Чтобы ИИ реализовал код точнее, включайте в задачи следующее:

### Хороший пример

```markdown
## Заголовок
Добавить валидацию email в API регистрации пользователей

## Описание
- Добавить проверку поля `email` в теле запроса `POST /api/users`
- Принимать только email согласно RFC 5322
- Возвращать 400 Bad Request для невалидных email

## Критерии приёмки
- [x] Валидация email реализована
- [x] Тесты добавлены
- [x] Существующие тесты проходят
```

### Плохой пример

```markdown
Исправить email
```

> [!WARNING]
> Расплывчатые задачи напрямую влияют на качество реализации ИИ. Рекомендуется писать конкретные требования и критерии приёмки.

## Классификация сложности задач

ADOS анализирует содержимое задачи и автоматически классифицирует сложность:

| Сложность | Характеристики | Расчётное время |
|-----------|---------------|----------------|
| **Simple** | Изменение одного файла, исправление опечатки | 1-3 мин |
| **Medium** | Несколько файлов, новая функция | 3-10 мин |
| **Complex** | Изменение архитектуры, крупный рефакторинг | 10-30 мин |

## Процесс обработки

### 1. Обнаружение задачи
- Watcher периодически опрашивает задачи
- Получает необработанные задачи с указанной меткой
- Также возможно обнаружение в реальном времени через webhook'и

### 2. Сбор контекста
- Анализ структуры кода репозитория
- Чтение `copilot-instructions.md` и `.ados.yaml`
- Определение существующих паттернов тестов и документации

### 3. Реализация ИИ
- Выбранный агент (Copilot / Claude / Codex) генерирует код
- Создаёт и запускает тесты
- Следует конвенциям кода

### 4. Создание PR
- Создаёт ветку (`ados/issue-{number}`)
- Коммитит и отправляет изменения
- Создаёт PR, связанный с задачей
- Автоматически генерирует описание PR

### 5. Цикл обратной связи
- Отслеживает результаты CI/CD
- При сбое тестов пытается автоматически исправить
- Публикует комментарии со статусом в задаче

## Отслеживание статуса

Обработка задач отслеживается со следующими статусами:

| Статус | Описание |
|--------|----------|
| `queued` | Ожидает обработки |
| `in_progress` | ИИ реализует |
| `pr_created` | PR создан |
| `ci_fixing` | Авторемонт CI |
| `completed` | Слито и завершено |
| `failed` | Обработка не удалась |
