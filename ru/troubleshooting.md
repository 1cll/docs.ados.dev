# Устранение неполадок

Частые проблемы и способы их решения.

## Задачи не обрабатываются

### Проверьте метку
Убедитесь, что к задаче прикреплена правильная метка. По умолчанию — `ados`.

```yaml
repos:
  - name: my-repo
    label: ados    # Обрабатываются только задачи с этой меткой
```

### Проверьте статус Watcher
В панели управления перейдите в **Settings** → **Repos** и убедитесь, что Issue Watcher включён.

```yaml
workers:
  issue_watcher:
    enabled: true   # Убедитесь, что значение true
```

### Проверьте логи
Просматривайте подробные логи на вкладке **Logs** в панели управления.

---

## PR не создаётся

### Конфликт веток
Создание PR может не удаться, если ветка с таким именем уже существует.

**Решение:** Вручную удалите ветку `ados/issue-{number}` на GitHub.

### Ошибка доступа
PR не может быть создан, если у GitHub App или токена нет прав на запись.

**Решение:** Проверьте права GitHub App или убедитесь, что scope PAT включает `repo`.

---

## Низкое качество реализации ИИ

### Улучшите copilot-instructions.md

Качество результатов ИИ сильно зависит от содержимого `copilot-instructions.md`.

**Решение:**
1. Четко укажите технологический стек и конвенции кода
2. Опишите файловую структуру и архитектуру
3. Приведите конкретные примеры
4. Перечислите запрещённые паттерны

→ Подробности в [Написание copilot-instructions.md](ru/guides/writing-instructions.md)

### Улучшите описания задач

Расплывчатые задачи — расплывчатые реализации.

**Решение:**
- Пишите конкретные требования
- Определяйте критерии приёмки
- Ссылайтесь на соответствующие файлы и код

→ См. раздел «Написание хороших задач» в [Автоматизация задач](ru/guides/issue-automation.md)

### Смените агента

Используйте наиболее подходящего ИИ-агента для задачи.

| Проблема | Рекомендация |
|----------|-------------|
| Простое исправление | Copilot |
| Новая функция | Claude |
| Сложный рефакторинг | Claude (opus) |

---

## Авторемонт CI/CD не работает

### Включите Pipeline Watcher

```yaml
workers:
  pipeline_watcher:
    enabled: true   # Убедитесь, что значение true
```

### Доступ к логам CI

Pipeline Watcher нуждается в доступе к логам CI. Для GitHub Actions требуется разрешение `actions: read`.

---

## Work Runner не подключается

### Проверьте переменные окружения

Убедитесь, что все обязательные переменные заданы:

```bash
echo $ADOS_API_URL      # Не должно быть пустым
echo $ADOS_TOKEN         # Не должно быть пустым
echo $ADOS_RUNNER_ID     # Не должно быть пустым
echo $WORKSPACE_DIR      # Не должно быть пустым
```

### Сетевое подключение

Work Runner должен подключаться к следующим эндпоинтам:

| Эндпоинт | Протокол | Назначение |
|----------|----------|------------|
| `api.ados.dev` | HTTPS (443) | API-взаимодействие |
| `api.ados.dev` | WSS (443) | WebSocket-связь |
| `github.com` | HTTPS (443) | GitHub API |

Убедитесь, что эти домены не заблокированы межсетевым экраном.

### Docker Socket

Проверьте корректность монтирования `docker.sock`:

```bash
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  alpine docker info
```

---

## Достигнут лимит запросов

### Лимиты GitHub API

Возможно, вы достигли лимита GitHub API (5 000 запросов/час для PAT).

**Решение:**
- Увеличьте `poll_interval` (например, `30s` → `60s`)
- Используйте GitHub App (более высокие лимиты)

### Лимиты ADOS API

| План | Лимит |
|------|-------|
| Free | 100 запросов/мин |
| Pro | 500 запросов/мин |
| Team | 2000 запросов/мин |

**Решение:** Рассмотрите обновление плана.

---

## SRE-агент не отправляет оповещения

### Проверьте GCP-аутентификацию

```bash
gcloud auth application-default login
gcloud config set project YOUR_PROJECT_ID
```

### Проверьте пороги

Пороги могут быть заданы слишком высоко:

```yaml
sre_agent:
  error_threshold: 10         # Попробуйте уменьшить
  latency_threshold_ms: 5000  # Попробуйте уменьшить
```

---

## Проблема не решена?

1. **Проверьте логи**: Просмотрите подробные логи на вкладке Logs
2. **Поиск по документации**: Используйте строку поиска на этом сайте
3. **Поддержка**: Пользователи плана Team имеют доступ к выделенному каналу поддержки
