# パイプライン監視 & 自動修復

Pipeline Watcher は CI/CD パイプラインの失敗を検知し、AI が自動で修復コードを生成・プッシュします。

## 概要

```
┌──────────────┐     ┌───────────────┐     ┌──────────────┐     ┌──────────────┐
│  CI/CD 失敗   │ ──▶ │  原因を分析    │ ──▶ │  修復コード    │ ──▶ │  プッシュ     │
│  (検知)       │     │  (AI 解析)    │     │  (AI 生成)   │     │  (自動)      │
└──────────────┘     └───────────────┘     └──────────────┘     └──────────────┘
```

## 有効化

```yaml
repos:
  - name: my-repo
    workers:
      pipeline_watcher:
        enabled: true
```

## 対応 CI/CD プラットフォーム

| プラットフォーム | 検知方法 |
|----------------|---------|
| **GitHub Actions** | Webhook / API ポーリング |
| **GitLab CI** | Webhook / API ポーリング |
| **CircleCI** | API ポーリング |
| **Jenkins** | Webhook |

## 検知するエラータイプ

Pipeline Watcher は以下のエラーを自動的に分類・対処します：

### テスト失敗
- ユニットテストの失敗
- 統合テストのタイムアウト
- E2E テストのアサーションエラー

### ビルドエラー
- コンパイルエラー
- 型エラー（TypeScript 等）
- 依存関係の解決失敗

### リント / フォーマット
- ESLint / Prettier のエラー
- Go lint、Clippy (Rust) 等

### セキュリティスキャン
- 脆弱性のある依存関係
- セキュリティルール違反

## 自動修復の流れ

### 1. 失敗の検知
Pipeline Watcher が CI/CD の失敗を Webhook またはポーリングで検知

### 2. ログの取得
失敗したジョブのログを自動取得し、エラーメッセージを抽出

### 3. AI 分析
エラーメッセージとソースコードを AI に渡し、根本原因を特定

### 4. 修復コードの生成
AI が修復パッチを生成し、既存の PR に追加コミットとしてプッシュ

### 5. 結果の確認
修復後の CI 結果を再度監視。成功すればクローズ、失敗すれば再試行

## 再試行の制限

自動修復の無限ループを防ぐため、再試行回数に制限があります：

| パラメータ | デフォルト | 説明 |
|-----------|-----------|------|
| 最大再試行回数 | 3 | 1 つの PR あたりの修復試行回数 |
| クールダウン | 5 分 | 再試行間の待機時間 |

## ユースケース

### テスト失敗の自動修復

```
1. PR を作成
2. GitHub Actions でテスト実行
3. テスト 2 件失敗
4. Pipeline Watcher が検知
5. AI がテストログを分析
6. 修正コミットを自動プッシュ
7. テスト再実行 → 成功 ✅
```

### 依存関係エラーの修正

```
1. Dependabot が依存関係を更新
2. ビルドが壊れる
3. Pipeline Watcher が検知
4. AI が互換性を確認
5. 互換コードに修正
6. ビルド成功 ✅
```

> [!TIP]
> Pipeline Watcher は [Issue 自動化](guides/issue-automation.md) で作成された PR だけでなく、人間が作成した PR の CI 失敗も監視できます。
